import*as messaging from"messaging";import{settingsStorage as e}from"settings";function t(e,t){var s,i=a(t.BattleStart),o=r(t.BattleStart),g=r(t.BattleEnd);fetch(`https://api.fitbit.com/1.2/user/-/activities/steps/date/${i}/${i}/15min/time/${o}/${g}.json`,{method:"GET",headers:{Authorization:`Bearer ${e}`}}).then(function(e){return e.json()}).then(function(e){s=parseInt(e["activities-steps"][0].value)}).catch(function(e){n()}),setTimeout(function(){messaging.peerSocket.readyState===messaging.peerSocket.OPEN&&messaging.peerSocket.send(s)},3e3)}function n(){if(messaging.peerSocket.readyState===messaging.peerSocket.OPEN){var e={stepsWalked:"Error"};setTimeout(function(){messaging.peerSocket.readyState===messaging.peerSocket.OPEN&&messaging.peerSocket.send(e)},3e3)}}function s(s){var a=!0;for(let n=0;n<e.length;n++){let r=e.key(n);if(r&&"oauth"===r){a=!1,t(JSON.parse(e.getItem(r)).access_token,s)}}a&&n()}function a(e){if(null!=e){var t=(e=new Date(e)).getDate(),n=e.getMonth()+1;return e.getFullYear()+"-"+(n<10?"0":"")+n+"-"+(t<10?"0":"")+t}return"00-00-0000"}function r(e){if(null!=e){var t=(e=new Date(e)).getHours(),n=e.getMinutes();return(t<10?"0":"")+t+":"+(n<10?"0":"")+n}return"00:00:00"}messaging.peerSocket.onmessage=(e=>{s(e.data)});